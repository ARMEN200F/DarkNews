<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>DarkNews</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { background:#000; color:#f00; font-family:Arial }
    .box { background:#111; padding:15px; margin:15px 0 }
    button { background:#f00; color:#fff; border:none; padding:8px 12px; cursor:pointer; margin:5px 0 }
    textarea, input { width:100%; background:#222; color:#fff; border:1px solid #444; padding:8px }
    .article { border-left:4px solid #f00; padding:10px; margin:15px 0; background:#151515 }
    .comment { background:#222; padding:6px; margin:4px 0 }
  </style>
</head>
<body>

<div id="loginBox" class="box">
  <h2>DarkNews</h2>
  <button onclick="openUser()">–í–æ–π—Ç–∏ –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</button>
  <button onclick="openAuthor()">–í–æ–π—Ç–∏ –∫–∞–∫ –∞–≤—Ç–æ—Ä</button>
</div>

<div id="authorLogin" class="box" style="display:none">
  <input id="promo" placeholder="–ü—Ä–æ–º–æ–∫–æ–¥">
  <button onclick="checkPromo()">–í–æ–π—Ç–∏</button>
</div>

<div id="authorPanel" class="box" style="display:none">
  <textarea id="articleText" placeholder="–¢–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏"></textarea>
  <button onclick="addArticle()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
</div>

<div id="articles" class="box" style="display:none">
  <h3>–°—Ç–∞—Ç—å–∏</h3>
  <div id="list"></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  // üîπ Firebase config
  firebase.initializeApp({
    apiKey: "AIzaSyCcg7VJbtbhluJMIfCSzdPZUKoQmYT43ro",
    authDomain: "darknews-904eb.firebaseapp.com",
    projectId: "darknews-904eb"
  });

  const db = firebase.firestore();
</script>

<script>
  const PROMO = "087212";

  function openUser(){
    document.getElementById("loginBox").style.display="none";
    document.getElementById("articles").style.display="block";
    loadArticles();
  }

  function openAuthor(){
    document.getElementById("loginBox").style.display="none";
    document.getElementById("authorLogin").style.display="block";
  }

  function checkPromo(){
    if(document.getElementById("promo").value === PROMO){
      document.getElementById("authorLogin").style.display="none";
      document.getElementById("authorPanel").style.display="block";
      document.getElementById("articles").style.display="block";
      loadArticles();
    } else alert("–ù–µ–≤–µ—Ä–Ω–æ");
  }

  function addArticle(){
    const text = articleText.value.trim();
    if(!text) return;
    db.collection("articles").add({
      text, likes:0, comments:[]
    });
    articleText.value="";
  }

  function loadArticles(){
    db.collection("articles").onSnapshot(snap=>{
      list.innerHTML="";
      snap.forEach(doc=>{
        const a = doc.data();
        const div = document.createElement("div");
        div.className="article";
        div.innerHTML = `
          <p>${a.text}</p>
          <button onclick="like('${doc.id}',${a.likes})">‚ù§Ô∏è ${a.likes}</button>
          <div>
            ${(a.comments||[]).map(c=>`<div class="comment">${c}</div>`).join("")}
            <textarea id="c${doc.id}" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"></textarea>
            <button onclick="comment('${doc.id}')">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
          </div>
        `;
        list.appendChild(div);
      });
    });
  }

  function like(id,l){
    db.collection("articles").doc(id).update({likes:l+1});
  }

  function comment(id){
    const t = document.getElementById("c"+id).value;
    if(!t) return;
    const ref = db.collection("articles").doc(id);
    ref.update({ comments: firebase.firestore.FieldValue.arrayUnion(t) });
  }
</script>

</body>
</html>