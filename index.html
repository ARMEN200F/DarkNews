<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>DarkNews —Å Firebase</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #000; color: #FF0000; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .content { padding: 20px; background-color: #121212; margin-bottom: 20px; }
        .button-container { text-align: center; margin-top: 20px; }
        .button-container button { padding: 10px 20px; font-size: 16px; cursor: pointer; background-color: #FF0000; color: white; border: none; margin: 5px; }
        .article { background-color: #1a1a1a; padding: 10px; margin-bottom: 20px; border-left: 5px solid #FF0000; }
        .comment { background-color: #333; padding: 10px; margin-bottom: 10px; }
        textarea, input[type="text"], input[type="password"], input[type="email"] { background-color: #1a1a1a; color: white; border: 1px solid #555; width: 100%; padding: 8px; margin-top: 10px; resize: vertical; }
        img { display: block; margin-top: 10px; max-width: 100%; height: auto; }
    </style>
</head>
<body>

<div class="container">
    <div class="content" id="loginSection">
        <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ DarkNews!</h1>
        <div class="button-container">
            <button onclick="showUserLogin()">–í–æ–π—Ç–∏ –∫–∞–∫ –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</button>
            <button onclick="showAuthorLogin()">–í–æ–π—Ç–∏ –∫–∞–∫ –∞–≤—Ç–æ—Ä</button>
        </div>
    </div>

    <div id="userLogin" class="content" style="display:none;">
        <h2>–í—Ö–æ–¥ —á–µ—Ä–µ–∑ Gmail</h2>
        <input type="email" id="userEmail" placeholder="–í–≤–µ–¥–∏—Ç–µ Gmail" autocomplete="off" />
        <input type="password" id="userPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" autocomplete="off" />
        <button onclick="verifyUser()">–í–æ–π—Ç–∏ / –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
    </div>

    <div id="articles" class="content" style="display:none;">
        <h2>–°—Ç–∞—Ç—å–∏</h2>
        <div id="articleList"></div>
    </div>

    <div id="authorLogin" class="content" style="display:none;">
        <h2>–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥ –¥–ª—è –≤—Ö–æ–¥–∞ –∫–∞–∫ –∞–≤—Ç–æ—Ä</h2>
        <input type="text" id="promoCode" placeholder="–ü—Ä–æ–º–æ–∫–æ–¥" autocomplete="off" />
        <button onclick="verifyPromoCode()">–í–æ–π—Ç–∏ –∫–∞–∫ –∞–≤—Ç–æ—Ä</button>
    </div>

    <div id="authorSection" class="content" style="display:none;">
        <h2>–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—é —Å—Ç–∞—Ç—å—é</h2>
        <textarea id="articleInput" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à—É —Å—Ç–∞—Ç—å—é..." rows="4"></textarea>
        <h3>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –≤–∞—à–µ–π —Å—Ç–∞—Ç—å–∏</h3>
        <input type="file" id="imageInput" accept="image/*" />
        <button onclick="submitArticle()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—å—é</button>
    </div>
</div>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, updateDoc, doc, arrayUnion, arrayRemove } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCcg7VJbtbhluJMIfCSzdPZUKoQmYT43ro",
    authDomain: "darknews-904eb.firebaseapp.com",
    projectId: "darknews-904eb",
    storageBucket: "darknews-904eb.appspot.com",
    messagingSenderId: "699679383044",
    appId: "1:699679383044:web:9350eef89940dca0771f51"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // ---------------- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è ----------------
  const validPromoCode = "087212";
  let currentUserEmail = "";

  function showUserLogin() {
      document.getElementById("userLogin").style.display = "block";
      document.getElementById("articles").style.display = "none";
      document.getElementById("authorLogin").style.display = "none";
      document.getElementById("authorSection").style.display = "none";
      document.getElementById("loginSection").style.display = "none";
  }

  function showAuthorLogin() {
      document.getElementById("authorLogin").style.display = "block";
      document.getElementById("articles").style.display = "none";
      document.getElementById("authorSection").style.display = "none";
      document.getElementById("userLogin").style.display = "none";
      document.getElementById("loginSection").style.display = "none";
  }

  function verifyUser() {
      const email = document.getElementById("userEmail").value.trim();
      const password = document.getElementById("userPassword").value.trim();
      if (!email || !password) { alert("–í–≤–µ–¥–∏—Ç–µ Gmail –∏ –ø–∞—Ä–æ–ª—å"); return; }
      currentUserEmail = email;
      alert("–í—ã –≤–æ—à–ª–∏ –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å!");
      showArticles();
      loadArticles();
  }

  function verifyPromoCode() {
      const promoCode = document.getElementById("promoCode").value.trim();
      if (promoCode === validPromoCode) {
          document.getElementById("authorSection").style.display = "block";
          document.getElementById("authorLogin").style.display = "none";
      } else { alert("–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥"); }
  }

  // ---------------- –°—Ç–∞—Ç—å–∏ ----------------
  async function submitArticle() {
      const text = document.getElementById("articleInput").value.trim();
      const imageFile = document.getElementById("imageInput").files[0];
      if (!text && !imageFile) { alert("–î–æ–±–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –∏–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"); return; }

      let imageData = "";
      if (imageFile) {
          const reader = new FileReader();
          reader.onloadend = async () => {
              imageData = reader.result;
              await saveArticleToFirebase(text, imageData);
          };
          reader.readAsDataURL(imageFile);
      } else {
          await saveArticleToFirebase(text, "");
      }
  }

  async function saveArticleToFirebase(text, image) {
      await addDoc(collection(db, "articles"), {
          text: text,
          image: image,
          likes: [],
          comments: []
      });
      document.getElementById("articleInput").value = "";
      document.getElementById("imageInput").value = "";
      loadArticles();
  }

  async function loadArticles() {
      const articleList = document.getElementById("articleList");
      articleList.innerHTML = "";
      const querySnapshot = await getDocs(collection(db, "articles"));
      querySnapshot.forEach((docSnap) => {
          const data = docSnap.data();
          const articleDiv = document.createElement("div");
          articleDiv.classList.add("article");

          const textP = document.createElement("p");
          textP.textContent = data.text;
          articleDiv.appendChild(textP);

          if (data.image) {
              const img = document.createElement("img");
              img.src = data.image;
              articleDiv.appendChild(img);
          }

          // –õ–∞–π–∫
          const likeBtn = document.createElement("button");
          const liked = data.likes.includes(currentUserEmail);
          likeBtn.textContent = liked ? `‚ù§Ô∏è ${data.likes.length}` : `ü§ç ${data.likes.length}`;
          likeBtn.onclick = async () => {
              const docRef = doc(db, "articles", docSnap.id);
              if (liked) {
                  await updateDoc(docRef, { likes: arrayRemove(currentUserEmail) });
              } else {
                  await updateDoc(docRef, { likes: arrayUnion(currentUserEmail) });
              }
              loadArticles();
          };
          articleDiv.appendChild(likeBtn);

          // –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
          if (data.comments) {
              data.comments.forEach(c => {
                  const cDiv = document.createElement("div");
                  cDiv.classList.add("comment");
                  cDiv.textContent = c;
                  articleDiv.appendChild(cDiv);
              });
          }

          const commentInput = document.createElement("textarea");
          commentInput.rows = 2;
          commentInput.placeholder = "–ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π...";
          articleDiv.appendChild(commentInput);

          const commentBtn = document.createElement("button");
          commentBtn.textContent = "–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π";
          commentBtn.onclick = async () => {
              if (!commentInput.value.trim()) return;
              const docRef = doc(db, "articles", docSnap.id);
              await updateDoc(docRef, { comments: arrayUnion(commentInput.value.trim()) });
              commentInput.value = "";
              loadArticles();
          };
          articleDiv.appendChild(commentBtn);

          articleList.appendChild(articleDiv);
      });
  }

  function showArticles() {
      document.getElementById("articles").style.display = "block";
      document.getElementById("authorLogin").style.display = "none";
      document.getElementById("authorSection").style.display = "none";
      document.getElementById("userLogin").style.display = "none";
      document.getElementById("loginSection").style.display = "none";
  }

</script>

</body>
</html>